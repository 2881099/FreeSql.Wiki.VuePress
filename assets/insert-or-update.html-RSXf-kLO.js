import{_ as n}from"./plugin-vue_export-helper-x3n3nnut.js";import{o as s,c as a,e as t}from"./app-o-tQI2bv.js";const e={},p=t(`<h1 id="insert-or-update" tabindex="-1"><a class="header-anchor" href="#insert-or-update" aria-hidden="true">#</a> Insert Or Update</h1><h2 id="_1-ifreesql-insertorupdate" tabindex="-1"><a class="header-anchor" href="#_1-ifreesql-insertorupdate" aria-hidden="true">#</a> 1. IFreeSql.InsertOrUpdate</h2><p><code>IFreeSql</code> defines the <code>InsertOrUpdate</code> method, which uses the characteristics and functions of the database to implement the added or modified functions. (since 1.5.0)</p><table><thead><tr><th>Database</th><th>Features</th><th></th><th>Database</th><th>Features</th></tr></thead><tbody><tr><td>MySql</td><td>on duplicate key update</td><td></td><td>Dameng</td><td>merge into</td></tr><tr><td>PostgreSQL</td><td>on conflict do update</td><td></td><td>Kingbase ES</td><td>on conflict do update</td></tr><tr><td>SqlServer</td><td>merge into</td><td></td><td>Shentong Database</td><td>merge into</td></tr><tr><td>Oracle</td><td>merge into</td><td></td><td>MsAccess</td><td>not support</td></tr><tr><td>Sqlite</td><td>replace into</td><td></td><td></td><td></td></tr><tr><td>Firebird</td><td>merge into</td><td></td><td></td><td></td></tr></tbody></table><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>fsql<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">InsertOrUpdate</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">SetSource</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token comment">//Data to be processed</span>
  <span class="token comment">//.IfExistsDoNothing() //If the data exists, do nothing (that means, insert the data if and only if the data does not exist)</span>
  <span class="token punctuation">.</span><span class="token function">ExecuteAffrows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>When the entity class has auto-increment properties, batch <code>InsertOrUpdate</code> can be split into two executions at most. Internally, FreeSql will calculate the data without self-increment and with self-increment, and execute the two commands of <code>insert into</code> and <code>merge into</code> mentioned above (using transaction execution).</p><p>Note: the common repository in <code>FreeSql.Repository</code> also has <code>InsertOrUpdate</code> method, but their mechanism is different.</p><hr><h2 id="_2-ifreesql-insertorupdatedict" tabindex="-1"><a class="header-anchor" href="#_2-ifreesql-insertorupdatedict" aria-hidden="true">#</a> 2. IFreeSql.InsertOrUpdateDict</h2><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> dic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dic<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dic<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xxxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fsql<span class="token punctuation">.</span><span class="token function">InsertOrUpdateDict</span><span class="token punctuation">(</span>dic<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsTable</span><span class="token punctuation">(</span><span class="token string">&quot;table1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WherePrimary</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecuteAffrows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//The generated SQL is the same as above</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-insertorupdate-in-freesql-repository" tabindex="-1"><a class="header-anchor" href="#_3-insertorupdate-in-freesql-repository" aria-hidden="true">#</a> 3. InsertOrUpdate in <code>FreeSql.Repository</code></h2><p>To use this method, you need to reference the <code>FreeSql.Repository</code> or <code>FreeSql.DbContext</code> extensions package.</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> repo <span class="token operator">=</span> fsql<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRepository</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
repo<span class="token punctuation">.</span><span class="token function">InsertOrUpdate</span><span class="token punctuation">(</span>YOUR_ENTITY<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>If there is data in the internal state management, then update it.</p><p>If there is no data in the internal state management, query the database to determine whether it exists.</p><blockquote><p>Update if it exists, insert if it doesn&#39;t exist</p></blockquote><p>Disadvantages: does not support batch operations</p><hr><h2 id="_4-batch-editing-beginedit" tabindex="-1"><a class="header-anchor" href="#_4-batch-editing-beginedit" aria-hidden="true">#</a> 4. Batch Editing: <code>BeginEdit</code></h2><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BeginEdit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    fsql<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Delete</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BeginEdit01<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;1=1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecuteAffrows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> repo <span class="token operator">=</span> fsql<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRepository</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BeginEdit01<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> cts <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BeginEdit01</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Category1&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BeginEdit01</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Category1_1&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BeginEdit01</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Category1_2&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BeginEdit01</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Category1_3&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BeginEdit01</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Category2&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BeginEdit01</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Category2_1&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BeginEdit01</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Category2_2&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    repo<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>cts<span class="token punctuation">)</span><span class="token punctuation">;</span>

    repo<span class="token punctuation">.</span><span class="token function">BeginEdit</span><span class="token punctuation">(</span>cts<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Start editing \`cts\`</span>

    cts<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">BeginEdit01</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Category2_3&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;123123&quot;</span><span class="token punctuation">;</span>
    cts<span class="token punctuation">.</span><span class="token function">RemoveAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> repo<span class="token punctuation">.</span><span class="token function">EndEdit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">BeginEdit01</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Guid</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>When the above code <code>EndEdit</code> method is executed, 3 SQL statements are generated, as follows:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token string">&quot;BeginEdit01&quot;</span><span class="token punctuation">(</span><span class="token string">&quot;Id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Name&quot;</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&#39;5f26bf07-6ac3-cbe8-00da-7dd74818c3a6&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Category2_3&#39;</span><span class="token punctuation">)</span>


<span class="token keyword">UPDATE</span> <span class="token string">&quot;BeginEdit01&quot;</span> <span class="token keyword">SET</span> <span class="token string">&quot;Name&quot;</span> <span class="token operator">=</span> <span class="token string">&#39;123123&#39;</span> 
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span><span class="token string">&quot;Id&quot;</span> <span class="token operator">=</span> <span class="token string">&#39;5f26bf00-6ac3-cbe8-00da-7dd01be76e26&#39;</span><span class="token punctuation">)</span>


<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token string">&quot;BeginEdit01&quot;</span> <span class="token keyword">WHERE</span> <span class="token punctuation">(</span><span class="token string">&quot;Id&quot;</span> <span class="token operator">=</span> <span class="token string">&#39;5f26bf00-6ac3-cbe8-00da-7dd11bcf54dc&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Use case: In winform, after loading the table data, perform some operations such as adding, modifying, and deleting, and then click [Save]</p><p>Note: This operation is only valid for the variable <code>cts</code>, not for comparison and update of the entire table.</p><h2 id="_4-on-duplicate-key-update-mysql-only" tabindex="-1"><a class="header-anchor" href="#_4-on-duplicate-key-update-mysql-only" aria-hidden="true">#</a> 4. <code>On Duplicate Key Update</code> (MySql only)</h2><p><code>FreeSql.Provider.MySql</code> and <code>FreeSql.Provider.MySqlConnector</code> support MySql&#39;s unique function <code>On Duplicate Key Update</code>.</p><p>This function can also insert or update data, and supports batch operations.</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">TestOnDuplicateKeyUpdateInfo</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Column</span><span class="token attribute-arguments"><span class="token punctuation">(</span>IsIdentity <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> title <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> time <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestOnDuplicateKeyUpdateInfo</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">&quot;title-100&quot;</span><span class="token punctuation">,</span> time <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2000-01-01&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
fsql<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">NoneParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">OnDuplicateKeyUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//INSERT INTO \`TestOnDuplicateKeyUpdateInfo\`(\`id\`, \`title\`, \`time\`) VALUES(100, &#39;title-100&#39;, &#39;2000-01-01 00:00:00.000&#39;)</span>
<span class="token comment">//ON DUPLICATE KEY UPDATE</span>
<span class="token comment">//\`title\` = VALUES(\`title\`), </span>
<span class="token comment">//\`time\` = VALUES(\`time\`)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Methods that can be called after <code>OnDuplicateKeyUpdate()</code>:</p><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>IgnoreColumns</td><td>Ignore updated columns, the mechanism is the same as <code>IUpdate.IgnoreColumns</code></td></tr><tr><td>UpdateColumns</td><td>Specify updated columns, the mechanism is the same as <code>IUpdate.UpdateColumns</code></td></tr><tr><td>Set</td><td>Manually specify the updated column, the same function as <code>IUpdate.Set</code></td></tr><tr><td>SetRaw</td><td>As a supplement to the <code>Set</code> method, SQL strings can be passed in.</td></tr><tr><td>ToSql</td><td>Return the SQL statement to be executed</td></tr><tr><td>ExecuteAffrows</td><td>Execute and return the number of rows affected</td></tr></tbody></table><p>Both <code>IInsert</code> and <code>OnDuplicateKeyUpdate</code> have <code>IgnoreColumns</code> and <code>UpdateColumns</code> methods.</p><p>When inserting an entity or a set of entities, the <code>time</code> column is ignored, the code is as follows:</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>fsql<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">IgnoreColumns</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>time<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">NoneParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">OnDuplicateKeyUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//INSERT INTO \`TestOnDuplicateKeyUpdateInfo\`(\`id\`, \`title\`) VALUES(200, &#39;title-200&#39;)</span>
<span class="token comment">//ON DUPLICATE KEY UPDATE</span>
<span class="token comment">//\`title\` = VALUES(\`title\`), </span>
<span class="token comment">//\`time\` = &#39;2000-01-01 00:00:00.000&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We found that the <code>UPDATE time</code> part became a constant instead of <strong>VALUES(\`time\`)</strong>. The mechanism is as follows:</p><p>When there are columns in the <code>insert</code> part, they will be set in the form of VALUES(\`field\`) in the <code>update</code>;</p><p>When a column that does not exist in the <code>insert</code> part, it will be set as a constant in the <code>update</code>. When manipulating the entity array, this constant is executed for <code>case when ... end</code> (same as <code>IUpdate</code>);</p><hr><h2 id="_5-on-conflict-do-update-postgresql-only" tabindex="-1"><a class="header-anchor" href="#_5-on-conflict-do-update-postgresql-only" aria-hidden="true">#</a> 5. <code>On Conflict Do Update</code> (PostgreSQL only)</h2><p><code>FreeSql.Provider.PostgreSQL</code> supports PostgreSQL 9.5+ unique function <code>On Conflict(id) Do Update</code>.</p><p>The usage method is roughly the same as that of MySql&#39;s <code>OnDuplicateKeyUpdate</code>.</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">TestOnConflictDoUpdateInfo</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Column</span><span class="token attribute-arguments"><span class="token punctuation">(</span>IsIdentity <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> title <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> time <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestOnConflictDoUpdateInfo</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">&quot;title-200&quot;</span><span class="token punctuation">,</span> time <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2000-01-01&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestOnConflictDoUpdateInfo</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">201</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">&quot;title-201&quot;</span><span class="token punctuation">,</span> time <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2000-01-01&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestOnConflictDoUpdateInfo</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">202</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">&quot;title-202&quot;</span><span class="token punctuation">,</span> time <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2000-01-01&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
fsql<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">IgnoreColumns</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>time<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">NoneParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">OnConflictDoUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//INSERT INTO &quot;&quot;testonconflictdoupdateinfo&quot;&quot;(&quot;&quot;id&quot;&quot;, &quot;&quot;title&quot;&quot;) VALUES(200, &#39;title-200&#39;), (201, &#39;title-201&#39;), (202, &#39;title-202&#39;)</span>
<span class="token comment">//ON CONFLICT(&quot;&quot;id&quot;&quot;) DO UPDATE SET</span>
<span class="token comment">//&quot;&quot;title&quot;&quot; = EXCLUDED.&quot;&quot;title&quot;&quot;, </span>
<span class="token comment">//&quot;&quot;time&quot;&quot; = CASE EXCLUDED.&quot;&quot;id&quot;&quot; </span>
<span class="token comment">//WHEN 200 THEN &#39;2000-01-01 00:00:00.000000&#39; </span>
<span class="token comment">//WHEN 201 THEN &#39;2000-01-01 00:00:00.000000&#39; </span>
<span class="token comment">//WHEN 202 THEN &#39;2000-01-01 00:00:00.000000&#39; END::timestamp</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,41),o=[p];function c(i,l){return s(),a("div",null,o)}const r=n(e,[["render",c],["__file","insert-or-update.html.vue"]]);export{r as default};
