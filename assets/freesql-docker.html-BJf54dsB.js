import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,a,o as n}from"./app-DRhx7JqD.js";const t={};function l(r,e){return n(),i("div",null,e[0]||(e[0]=[a(`<h1 id="docker-freesql" tabindex="-1"><a class="header-anchor" href="#docker-freesql"><span>Docker+ FreeSql</span></a></h1><h2 id="net5-docker-encryption-ssl-tls-handshake-failed" tabindex="-1"><a class="header-anchor" href="#net5-docker-encryption-ssl-tls-handshake-failed"><span>.net5+Docker+ Encryption(ssl/tls) handshake failed</span></a></h2><p>.net5 网站使用Sqlserver数据库部署在docker容器内运行报主库链接失败</p><h3 id="环境" tabindex="-1"><a class="header-anchor" href="#环境"><span>环境</span></a></h3><p>数据库：Sqlserver2014 网站程序：.Net5 Docker版本：Docker version 19.03.13, .net5环境镜像源：mcr.microsoft.com/dotnet/aspnet:5.0-buster-slim Centos版本：CentOS Linux release 7.9.2009 (Core)</p><h3 id="使用原生方式进行测试" tabindex="-1"><a class="header-anchor" href="#使用原生方式进行测试"><span>使用原生方式进行测试</span></a></h3><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">SqlConnection</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> connection</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> new </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">SqlConnection</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Data Source=xxxxx;User Id=sa;Password=xxxxxx;Initial Catalog=xxxxxxxx;Pooling=true;Min Pool Size=1;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    connection</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Open</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    connection</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Close</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    connection</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Dispose</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="报错" tabindex="-1"><a class="header-anchor" href="#报错"><span>报错</span></a></h3><p>A connection was successfully established with the server, but then an error occurred during the pre-login handshake. (provider: SSL Provider, error: 31 - Encryption(ssl/tls) handshake failed)</p><h3 id="最终解决方案" tabindex="-1"><a class="header-anchor" href="#最终解决方案"><span>最终解决方案</span></a></h3><p>在dockerfile里面加上这么两句</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" data-title="dockerfile" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> sed -i </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;s/MinProtocol = TLSv1.2/MinProtocol = TLSv1/g&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /etc/ssl/openssl.cnf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> sed -i </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;s/MinProtocol = TLSv1.2/MinProtocol = TLSv1/g&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /usr/lib/ssl/openssl.cnf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>将TLSv1.2设为TLSv1，只能是设为TLSv1而不是设为TLSv1.0</strong></p><h2 id="原文链接" tabindex="-1"><a class="header-anchor" href="#原文链接"><span>原文链接</span></a></h2><ul><li><a href="https://github.com/dotnetcore/FreeSql/issues/650" target="_blank" rel="noopener noreferrer">.net5 网站使用Sqlserver数据库部署在docker容器内运行报主库链接失败 · Issue #650 · dotnetcore/FreeSql (github.com)</a></li></ul>`,15)]))}const d=s(t,[["render",l],["__file","freesql-docker.html.vue"]]),p=JSON.parse('{"path":"/extra/freesql-docker.html","title":"Docker+ FreeSql","lang":"zh-CN","frontmatter":{"description":"Docker+ FreeSql .net5+Docker+ Encryption(ssl/tls) handshake failed .net5 网站使用Sqlserver数据库部署在docker容器内运行报主库链接失败 环境 数据库：Sqlserver2014 网站程序：.Net5 Docker版本：Docker version 19.03.13, ...","head":[["meta",{"property":"og:url","content":"https://freesql.net/extra/freesql-docker.html"}],["meta",{"property":"og:site_name","content":"FreeSql"}],["meta",{"property":"og:title","content":"Docker+ FreeSql"}],["meta",{"property":"og:description","content":"Docker+ FreeSql .net5+Docker+ Encryption(ssl/tls) handshake failed .net5 网站使用Sqlserver数据库部署在docker容器内运行报主库链接失败 环境 数据库：Sqlserver2014 网站程序：.Net5 Docker版本：Docker version 19.03.13, ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2022-06-24T16:45:08.000Z"}],["meta",{"property":"article:modified_time","content":"2022-06-24T16:45:08.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Docker+ FreeSql\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2022-06-24T16:45:08.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"nicye\\"}]}"],["link",{"rel":"alternate","type":"application/atom+xml","href":"https://freesql.net/atom.xml","title":"FreeSql Atom Feed"}],["link",{"rel":"alternate","type":"application/json","href":"https://freesql.net/feed.json","title":"FreeSql JSON Feed"}],["link",{"rel":"alternate","type":"application/rss+xml","href":"https://freesql.net/rss.xml","title":"FreeSql RSS Feed"}]]},"headers":[{"level":2,"title":".net5+Docker+ Encryption(ssl/tls) handshake failed","slug":"net5-docker-encryption-ssl-tls-handshake-failed","link":"#net5-docker-encryption-ssl-tls-handshake-failed","children":[{"level":3,"title":"环境","slug":"环境","link":"#环境","children":[]},{"level":3,"title":"使用原生方式进行测试","slug":"使用原生方式进行测试","link":"#使用原生方式进行测试","children":[]},{"level":3,"title":"报错","slug":"报错","link":"#报错","children":[]},{"level":3,"title":"最终解决方案","slug":"最终解决方案","link":"#最终解决方案","children":[]}]},{"level":2,"title":"原文链接","slug":"原文链接","link":"#原文链接","children":[]}],"git":{"createdTime":1656089108000,"updatedTime":1656089108000,"contributors":[{"name":"igeekfan","username":"igeekfan","email":"luoyunchong@foxmail.com","commits":1,"url":"https://github.com/igeekfan"}]},"readingTime":{"minutes":0.72,"words":216},"filePathRelative":"extra/freesql-docker.md","localizedDate":"2022年6月24日","autoDesc":true}');export{d as comp,p as data};
